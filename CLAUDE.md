# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

This is a personal scripts and utilities repository containing shell scripts, Python programs, and Kubernetes YAML configurations. The repository is primarily used for automation tasks, system administration, and learning/practice purposes.

## Directory Structure

- **shell/** - Bash scripts for system automation and utilities
- **python/** - Python scripts for interactive programs
- **k8s/yaml/** - Kubernetes pod definitions and configurations
- **docker/** - Docker-related files (currently empty)

## Common Commands

### Python Scripts

Run Python scripts directly:
```bash
python3 python/hello_response.py
```

Install Python dependencies:
```bash
pip3 install -r requirements.txt
```

### Shell Scripts

Execute shell scripts with bash:
```bash
bash shell/clear_log.sh
bash shell/vim_practice.sh
```

Make scripts executable:
```bash
chmod +x shell/<script_name>.sh
```

### Kubernetes

Apply Kubernetes configurations:
```bash
kubectl apply -f k8s/yaml/initPod.yml
```

### Git Workflow

This repository uses standard git practices:
```bash
git status
git add <files>
git commit -m "message"
git push
```

Commits follow a descriptive style with optional emoji and include Claude Code attribution when generated by Claude.

## Code Architecture & Patterns

### Shell Scripts

Shell scripts in this repository follow these patterns:

1. **Extensive inline documentation** - Every line is commented with explanations of what it does, syntax details, and purpose
2. **Function-based organization** - Scripts use helper functions with clear responsibilities (e.g., `log_message()`, `is_last_day_of_month()`, `cleanup_logs()`)
3. **Configuration variables at top** - Paths, retention periods, and settings defined as variables in the header
4. **Logging to files** - Operations logged to `/var/log/` with timestamps using `tee -a`
5. **Error handling** - Directory existence checks, validation before operations
6. **Null-safe file processing** - Using `find -print0` with `while IFS= read -r -d ''` for handling filenames with spaces

Example pattern from clear_log.sh:
```bash
# Configuration section
LOG_DIR="/tmp/dumas"
SCRIPT_LOG="/var/log/log_cleanup.log"
RETENTION_DAYS=30

# Reusable logging function
log_message() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" | tee -a "$SCRIPT_LOG"
}

# Main execution in main() function
main() {
    log_message "Script started"
    # ... logic here
}
main "$@"
```

### Python Scripts

Python scripts follow these conventions:

1. **Shebang with python3** - `#!/usr/bin/env python3`
2. **Comprehensive docstrings** - Module-level and function-level documentation
3. **Type hints** - Function signatures use type annotations (e.g., `-> Optional[str]`)
4. **Pattern matching with regex** - Using `re` module for flexible input validation
5. **Robust input handling** - Try/except blocks for EOFError, KeyboardInterrupt, and general exceptions
6. **Helper functions** - Small, single-purpose functions (normalize, validate, display)
7. **Main guard** - `if __name__ == "__main__":` pattern

Example pattern from hello_response.py:
```python
def normalize_input(user_input: str) -> str:
    """Normalize user input by stripping whitespace and converting to lowercase."""
    if user_input is None:
        return ""
    return user_input.strip().lower()

def main():
    """Main program loop."""
    try:
        while True:
            # ... loop logic
    except KeyboardInterrupt:
        sys.exit(0)

if __name__ == "__main__":
    main()
```

## Documentation Standards

When adding or modifying code in this repository:

### For Shell Scripts
- Add comprehensive inline comments explaining each line
- Include header comments with purpose, author, and date
- Document function parameters and return values
- Explain bash syntax and special constructs (e.g., process substitution, parameter expansion)

### For Python Scripts
- Include module-level docstrings describing purpose and features
- Add function docstrings for all functions
- Use type hints for function parameters and return values
- Handle exceptions appropriately with informative messages

## Special Considerations

### File Paths
- Shell scripts may reference system paths like `/tmp/dumas` and `/var/log/`
- Ensure proper permissions when running scripts that write to system directories

### Date Handling
Scripts use various date command formats:
- `date '+%Y-%m-%d %H:%M:%S'` - Full timestamp
- `date -d "$today + 1 day" '+%Y-%m-%d'` - Date arithmetic

### Kubernetes YAML
- Note: The initPod.yml file contains typos ("metadate" should be "metadata", "sleeps" should be "sleep", "port" should be "ports")
- When editing K8s files, validate syntax before applying

## Testing

### Shell Scripts
Test scripts in safe environments or with modified paths before running with system paths. For clear_log.sh:
```bash
# Test with a safe directory
LOG_DIR="/tmp/test_logs" bash shell/clear_log.sh
```

### Python Scripts
Run Python scripts directly to test functionality:
```bash
python3 python/hello_response.py
```

## Notes

- The README.md contains a merge conflict that should be resolved
- The repository mixes English and Chinese content (README has Chinese Snake game description)
- Scripts are well-documented for educational purposes
